DROP TABLE IF EXISTS USERS, REQUESTS, ITEMS, BOOKINGS, COMMENTS;

CREATE TABLE IF NOT EXISTS USERS
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(512) NOT NULL,
    CONSTRAINT pk_user PRIMARY KEY (id),
    CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
    );

CREATE TABLE IF NOT EXISTS REQUESTS
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    description varchar(512) NOT NULL,
    requestor_id bigint REFERENCES USERS (id) ON DELETE CASCADE,
    created timestamp,
    CONSTRAINT pk_request PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS ITEMS
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name varchar(255) NOT NULL,
    description varchar(512) NOT NULL,
    available boolean,
    owner_id bigint REFERENCES USERS (id) ON DELETE CASCADE,
    request_id bigint REFERENCES REQUESTS (id) ON DELETE CASCADE,
    CONSTRAINT pk_item PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS BOOKINGS
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    starttime timestamp NOT NULL,
    endtime timestamp NOT NULL,
    item_id bigint REFERENCES ITEMS (id) ON DELETE CASCADE,
    booker_id bigint REFERENCES USERS (id) ON DELETE CASCADE,
    status varchar(8) NOT NULL,
    CONSTRAINT pk_booking PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS COMMENTS
(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    text varchar(512) NOT NULL,
    item_id bigint REFERENCES ITEMS (id) ON DELETE CASCADE,
    author_id bigint REFERENCES USERS (id) ON DELETE CASCADE,
    created timestamp NOT NULL,
    CONSTRAINT pk_comment PRIMARY KEY (id)
    );